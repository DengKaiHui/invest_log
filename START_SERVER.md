# 股票价格服务使用说明

## 🚀 快速开始

### 1. 安装依赖
```bash
npm install
```

### 2. 启动后端服务
```bash
npm start
```

服务将运行在 `http://localhost:3001`

### 3. 启动前端
打开另一个终端，启动前端服务器（使用你喜欢的方式，例如：）
```bash
# 使用 Python
python3 -m http.server 8000

# 或使用 VS Code 的 Live Server 扩展
```

然后在浏览器访问 `http://localhost:8000/index.html`

---

## ✨ 功能特性

### 1️⃣ 自动缓存
- 价格数据自动缓存 **30分钟**
- 减少API调用，提高响应速度
- 降低被限流的风险

### 2️⃣ 定时刷新
- 后端每 **5分钟** 自动检查过期缓存
- 自动更新超过30分钟的价格数据
- 无需手动干预

### 3️⃣ 手动刷新
- 点击"刷新价格"按钮强制更新所有价格
- 支持批量获取，智能限流
- 实时显示更新状态

### 4️⃣ 智能加载
- 页面加载时优先使用缓存数据
- 缓存有效时立即显示，无需等待
- 缓存失效时自动请求最新数据

---

## 📡 API 接口说明

### 获取单个股票价格
```
GET /api/price/:symbol?force=true
```
- `symbol`: 股票代码（如 NVDA）
- `force`: 是否强制刷新（默认 false）

### 批量获取股票价格
```
POST /api/prices
Content-Type: application/json

{
  "symbols": ["NVDA", "AAPL", "TSLA"],
  "force": false
}
```

### 手动刷新价格
```
POST /api/refresh
Content-Type: application/json

{
  "symbols": ["NVDA", "AAPL", "TSLA"]
}
```

### 查看缓存状态
```
GET /api/cache/status
```

### 清除所有缓存
```
DELETE /api/cache
```

---

## 🔧 配置说明

### 缓存时间
在 `server.js` 中修改：
```javascript
const CACHE_EXPIRY = 30 * 60 * 1000; // 30分钟（毫秒）
```

### 自动检查间隔
在 `server.js` 的 `startAutoRefresh()` 函数中修改：
```javascript
}, 5 * 60 * 1000); // 每5分钟检查一次
```

### 端口号
在 `server.js` 中修改：
```javascript
const PORT = 3001;
```

同时需要在 `src/utils/api.js` 中同步修改：
```javascript
const API_BASE_URL = 'http://localhost:3001/api';
```

---

## 🐛 常见问题

### Q1: 提示"无法连接到价格服务"
**A:** 确保后端服务已启动。运行 `npm start` 启动服务。

### Q2: 价格显示为 "--"
**A:** 可能是股票代码错误或网络问题。检查：
1. 股票代码是否正确（需要使用Yahoo Finance的代码）
2. 网络是否可访问Yahoo Finance
3. 查看后端控制台的错误日志

### Q3: CORS 错误
**A:** 后端已配置 CORS，如果仍有问题：
1. 确认前端和后端URL正确
2. 检查浏览器控制台的详细错误信息
3. 尝试清除浏览器缓存

### Q4: 价格更新很慢
**A:** 这是正常现象：
1. 为避免被限流，批量更新时每个股票间隔200ms
2. 如有10个股票，大约需要2秒
3. 使用缓存可以避免频繁更新

---

## 📊 性能优化建议

1. **首次加载**：使用 `autoLoadPrices()`，优先使用缓存
2. **定期更新**：依赖后端自动刷新，无需频繁手动刷新
3. **批量操作**：添加多个股票后一次性刷新
4. **合理缓存**：根据需求调整缓存时间（默认30分钟合适）

---

## 🛠️ 开发模式

使用 Node.js 的 watch 模式，代码修改后自动重启：
```bash
npm run dev
```

---

## 📝 日志说明

后端控制台会显示：
- ✓ 成功获取价格
- ⚠ 警告信息
- ✗ 错误信息
- ↻ 使用缓存
- ⏰ 定时刷新

---

## 🎯 使用建议

1. **首次使用**：点击"刷新价格"获取最新数据
2. **日常使用**：依赖自动刷新，无需频繁点击
3. **重要决策**：手动刷新确保数据最新
4. **监控状态**：查看"最后更新"时间判断数据新鲜度

---

祝你投资顺利！📈
